\chapter{Progettazione e codifica}
\label{cap:progettazione-codifica}

\intro{Questo capitolo tratta della fase di progettazione e della fase di codifica dell'app, riportando tutto quello che è stato fatto e le difficoltà incontrate.}\\ 

\section{Progettazione}
\label{sec:progettazione}

\subsection{Struttura dell'app}

Dopo una prima parte di stage, dove ho studiato le tecnologie riportate al \hyperref[sec:tecnologie]{secondo capitolo}, ho pensato come sviluppare l'applicazione richiesta.\newline
Di prassi, in RiskAPP si utilizza Figma per poter avere una idea più chiara del lavoro che si desidera fare, quindi per prima cosa ho progettato la grafica e la struttura dell'app con l'aiuto di questo software di progettazione.\newline
Avendo una idea visiva, questo rendeva più facile spiegare al mio tutor come pensavo di impostare l'applicazione, andando poi a modificare e sistemare in base alle esigenze dell'azienda.\newline
\newline
Nella Figura \ref{fig:schermatefigma} ci sono tre schermate progettate in Figma, ovvero le schermate \textbf{Utente}, \textbf{Impostazioni} e infine \textbf{Home}.\newline
Dai \emph{mockup} capiamo che la struttura delle pagine è la seguente:
\begin{itemize}
    \item una barra superiore, dove è possibile eseguire una o due azioni;
    \item una schermata con le informazioni interessate;
    \item una barra inferiore che permette di navigare tra le schermate, fatta eccezione per la schermata \textbf{Impostazioni} che non ha questa barra.
\end{itemize}
Tramite la barra inferiore è possibile navigare tra le schermate:
\begin{itemize}
    \item \textbf{Home}, dove sarà visibile la \emph{\gls{cassacomuneg}}, la \emph{\gls{quotastornatag}} dell'utente e infine il piatto del giorno (successivamente cambiato in \emph{Proposte del giorno} per permettere la scelta di più piatti dal menu);
    \item \textbf{Spese}, che permette di visualizzare tutte le transazioni di tutti gli utenti e aggiungere delle nuove transazioni o eliminarle;
    \item \textbf{Menu}, dove è possibile consultare i piatti, aggiungerli oppure proporli come possibili piatti del giorno;
    \item \textbf{Utente}, la visualizzazione cambia tra utente semplice e utente amministratore. Quest'ultima è stata modificata durante la fase di codifica, ma principalmente serve per visualizzare e modificare le proprie presenze o, nel caso dell'amministratore, visualizzare e modificare le presenze degli stagisti o della \emph{\gls{quotapastog}}.
\end{itemize}
\begin{figure}[!h]
    \centering 
    \includegraphics[width=0.9\columnwidth]{figma/esempi} 
    \caption{Alcune schermate progettate in Figma}
    \label{fig:schermatefigma}
\end{figure}
La schermata \textbf{Impostazioni} è raggiungibile attraverso la schermata \textbf{Utente}, andando a toccare l'icona ad ingranaggio posta nella barra superiore.\newline
Da \textbf{Impostazioni} è possibile modificare i dati dell'utente oppure permettere all'utente di disconnettersi dalla sessione corrente.\newline
\newline
Sono state create diversamente anche le finestre \textbf{Accedi} (Figura \ref{fig:accedifigma}) e \textbf{Registrati} (Figura \ref{fig:registratifigma}).\newline
In queste due schermate non sono presenti barre superiori o inferiori, ma solo una serie di campi da compilare e il pulsante verde Accedi o Registrati.\newline
\textbf{Accedi} è la prima schermata che vede l'utente quando entra nell'app per la prima volta; per passare alla schermata \textbf{Registrati} bisogna toccare il link presente sotto al pulsante Accedi, dove è scritto il messaggio "\emph{Sei nuovo? REGISTRATI}".\newline
Per ritornare alla schermata \textbf{Accedi}, il procedimento è analogo, ovvero si tocca il link presente sotto il pulsante Registrati, dove è riportato il messaggio "\emph{Hai già un account? ACCEDI}".\newline
Invece, per andare in \textbf{Home}, bisognerà compilare correttamente i campi e poi toccare il pulsante verde presente.\newline
\newline
In \textbf{Accedi} è presente il messaggio "\emph{Hai dimenticato la password?}", questo doveva contenere un link che permetteva all'utente di recuperare la propria password, funzionalità prima prevista, poi ritenuta non più necessaria.\newline
%qui poi si dovrà riportare le schermate a 0.7 in base all'introduzione ---------------------------------------------------------------------------------------------------------------------------------------------------------------------
\begin{figure}[!h] 
    \centering 
    \includegraphics[width=0.6\columnwidth]{figma/accedi} 
    \caption{Schermata Accedi progettata in Figma}
    \label{fig:accedifigma}
\end{figure}
\begin{figure}[!h] 
    \centering 
    \includegraphics[width=0.6\columnwidth]{figma/registrati} 
    \caption{Schermata Registrati progettata in Figma}
    \label{fig:registratifigma}
\end{figure}
%Come è già stato detto, sono state fatte diverse modifiche in fase di progettazione, alcune modifiche sono state fatte perchè non rispettavano le idee del proponente, altre perchè non avevano utilità, come il recupero password appena accennato, altre modifiche sono state fatte anche a livello grafico, perchè non permetteva all'utente di capire che cosa poteva fare.\newline
%Per questo sono state fatte delle modifiche anche ai componenti utilizzati (nella figura \ref{fig:conteinerfigma} ci sono i \emph{component} creati per il \emph{mockup}), pure le icone dei pulsanti, che servivano solo a livello dimostrativo.
%\begin{figure}[!h] 
%    \centering 
%    \includegraphics[width=0.9\columnwidth]{figma/container} 
%    \caption{Alcuni pulsati e icone progettate in Figma}
%    \label{fig:conteinerfigma}
%\end{figure}

\newpage

\subsection{Database}
Per quanto riguarda la base di dati (Figura \ref{fig:database}), ho pensato a una struttura semplice, mettendo al centro l'utente che può inserire dei piatti, delle transazioni oppure segnare le proprie presenze.\newline
Si è poi pensato ad un'entità isolata, che ha il solo scopo di contenere le variabili globali, ovvero la \emph{\gls{cassacomuneg}}, la \emph{\gls{quotapastog}} e la \emph{\gls{quotastornatag}} degli stagisti.\newline
Per quanto riguarda gli stagisti, inizialmente si pensava se considerarli come un utente oppure se rappresentarli come un'altra entità; alla fine, è stato deciso di lavorare in modo diverso, dato che gli stagisti si ipotizza che non utilizzino l'app.\newline
Gli utenti amministratori possono aggiungere le spese e le presenze degli stagisti, mentre la loro \emph{\gls{quotastornatag}} è stato deciso di indicarla nell'entità Cassa Comune, dato che si tratta di un dato unico per tutti gli stagisti.\newline
\begin{figure}[!h] 
    \centering 
    \includegraphics[width=0.9\columnwidth]{database} 
    \caption{Il database progettato per l'applicazione}
    \label{fig:database}
\end{figure}
\newline
Lavorando con Firebase, un database noSQL, i dati sono stati gestiti in modo leggermente diverso, ma rimanendo fedeli alle entità riportate in Figura \ref{fig:database}.\newline
Questo perchè Firebase organizza i dati in \emph{raccolte}, ogni raccolta contiene dei \emph{documenti} e ogni documento è composto da \emph{campi}.\newline
Se dovessimo tradurre a livello teorico:
\begin{itemize}
    \item le \emph{raccolte} sono le entità;
    \item i \emph{documenti} sono le \emph{tuple}, cioè se dovessimo rappresentare le entità come una tabella, un documento è una riga di informazioni dell'entità;
    \item i \emph{campi} sono gli attributi, ovvero un singolo dato della \emph{tupla}.
\end{itemize}
Con Firebase si possono gestire i dati in modo diverso da quanto descritto, perchè i \emph{documenti} non sono rigidi, cioè i \emph{documenti} all'interno di una \emph{raccolta} possono avere quantità e tipi diversi di \emph{campi}, permettendo una struttura dinamica e lasciando al programmatore la libertà di decidere come gestire le informazioni.\newline
\newline
Per convenzione, è stato deciso di strutturare i dati come è stato descritto nell'elenco puntato, perchè risultava più semplice capire l'ordine delle informazioni e ha permesso una semplice gestione dei dati a livello di codice.\newline
Di seguito si riporta la struttura finale del database, riportando per ogni \textbf{raccolta} i \emph{campi} che ogni documento deve contenere.\newline

\newpage

\textbf{cassaComune}
\begin{itemize}
    \item \emph{cassaComune}, di tipo number (numerico)
    \item \emph{quotaPasti}, di tipo number
    \item \emph{quotaStornataStagisti}, di tipo number
\end{itemize}
Per questa raccolta esiste un solo \emph{documento} con codice identificativo "cassaComune".\newline

\textbf{utenti}
\begin{itemize}
    \item \emph{email}, di tipo string (stringa)
    \item \emph{nome}, di tipo string
    \item \emph{cognome}, di tipo string
    \item \emph{UID}, di tipo string; questo rappresenta il codice UID Satispay dell'utente
    \item \emph{quotaStornta}, di tipo string
    \item \emph{admin}, di tipo boolean (booleano)
\end{itemize}

\textbf{piatti}
\begin{itemize}
    \item \emph{nome}, di tipo string
    \item \emph{ingredienti}, di tipo string
    \item \emph{ricetta}, di tipo string
    \item \emph{propostoOggi}, di tipo timestamp; questo permette di capire quando è stata l'ultima volta che il piatto è stato proposto; se riporta la data odierna, il piatto dovrà comparire nella Home
    \item \emph{utente}, di tipo string; serve per capire quale utente ha inserito il piatto
\end{itemize}

\textbf{presenze}
\begin{itemize}
    \item \emph{data}, di tipo timestamp
    \item \emph{utente}, di tipo string
    \item \emph{quotaPasto}, di tipo number; indica quanto riportava la \emph{\gls{quotapastog}} il giorno in cui l'utente è stato presente a pranzo
    \item \emph{stagisti}, di tipo boolean; se impostato a \emph{true} vuol dire che la presenza indicata riporta la presenza degli stagisti e non dell'utente
    \item \emph{numStagisti}, di tipo number; se \emph{stagisti} è impostato a \emph{true} riporta quanti stagisti erano presenti nella data indicata
\end{itemize}
\newpage
\textbf{transazioni}
\begin{itemize}
    \item \emph{soldi}, di tipo number
    \item \emph{data}, di tipo timestamp
    \item \emph{utente}, di tipo sting
    \item \emph{stagista}, di tipo boolean; indica se è stato lo stgista ad effettuare la spesa (\emph{true}) o l'utente (\emph{false})
    \item \emph{spesa}, di tipo boolean; se \emph{true} indica che la transazione riportata è una spesa, altrimenti si tratta dell'invio dei soldi ad un altro utente
    \item \emph{utenteRiceveInvioSoldi}, di tipo string; se \emph{spesa} è impostato a \emph{false}, questo riporta l'utente che riceve i soldi
\end{itemize}

\newpage

\section{Design Pattern utilizzati}
%forse parlare dell'MVVM o BLoC patttern

\section{Codifica} %riportare qui il database?
%In questa sezione riporto la struttura della cartella lib, parlerò delle componenti e, del file firebase_option e delle classi
%riportare anche le immagine dell'app creata